!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d15748e9-a256-417d-91b3-7195fb3d9519",e._sentryDebugIdIdentifier="sentry-dbid-d15748e9-a256-417d-91b3-7195fb3d9519")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3569],{2316:(e,t,n)=>{"use strict";n.d(t,{H:()=>d});var s=n(47319),a=n(32144),r=n(80251),i=n(73969),l=n(15629),o=n(14155);async function c(e){let{projectRef:t,connectionString:n,id:a,tables:r,publish_insert:i,publish_update:o,publish_delete:c,publish_truncate:d}=e,{sql:u}=s.A.publications.update(a,{tables:r,publish_insert:i,publish_update:o,publish_delete:c,publish_truncate:d}),{result:m}=await (0,l.E)({projectRef:t,connectionString:n,sql:u,queryKey:["publication","update",a]});return m}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,a.jE)();return(0,r.n)(e=>c(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(o.b.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?i.oR.error("Failed to update database publication: ".concat(e.message)):t(e,n,s)},...n})}},14155:(e,t,n)=>{"use strict";n.d(t,{b:()=>s});let s={list:e=>["projects",e,"database-publications"]}},14861:(e,t,n)=>{"use strict";n.d(t,{K:()=>f,T:()=>b});var s=n(80263),a=n(53239),r=n(52647),i=n(51500),l=n(78721),o=n(53434),c=n.n(o),d=n(27344),u=n.n(d),m=n(37361),p=n.n(m);c().extend(u()),c().extend(p());let x=e=>c().unix(Number(e)/1e3/1e3).toISOString(),h=e=>{let t=16===String(e).length;return!Number.isNaN(Number(e))&&t},f=e=>{let{utcTimestamp:t,format:n}=e,s=h(t)?x(t):t;return c().utc(s).local().format(n)},g=e=>{let{utcTimestamp:t,format:n}=e,s=h(t)?x(t):t;return c().utc(s).format(n)},y=e=>{let{utcTimestamp:t}=e,n=h(t)?x(t):t;return c().utc(n).fromNow()},b=e=>{let{utcTimestamp:t,className:n,displayAs:o="local",format:c="DD MMM  HH:mm:ss",labelFormat:d="DD MMM HH:mm:ss"}=e,u=f({utcTimestamp:t,format:c}),m=g({utcTimestamp:t,format:c}),p=y({utcTimestamp:t}),[x,h]=(0,a.useState)("start"),b=(0,a.useRef)(null),v=Intl.DateTimeFormat().resolvedOptions().timeZone;(0,a.useEffect)(()=>{let e=()=>{if(b.current){let e=b.current.getBoundingClientRect(),t=window.innerHeight;h(e.top<t/2?"start":"end")}};return e(),window.addEventListener("scroll",e),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]);let j=e=>{let{label:t,value:n}=e,[l,o]=(0,a.useState)(!1);return(0,s.jsxs)("div",{onPointerDown:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),e.preventDefault(),(0,r.l)(n,()=>{o(!0),setTimeout(()=>{o(!1)},1e3)})},className:(0,i.cn)("relative cursor-pointer flex gap-y-2 gap-x-0.5 hover:bg-surface-100 px-2 py-1 group",{"bg-surface-100":l}),"data-sentry-component":"TooltipRow","data-sentry-source-file":"index.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2 text-left truncate",children:[(0,s.jsx)("p",{children:t}),(0,s.jsx)("div",{className:"border-t w-full border-dashed"})]}),(0,s.jsxs)("div",{className:"relative flex items-center gap-x-2 flex-grow",children:[(0,s.jsx)("div",{className:"border-t w-full border-dashed z-10"}),l&&(0,s.jsx)("span",{className:"flex items-center justify-end w-full absolute inset-0 flex items-right text-brand-600 bg-surface-100",children:"Copied!"}),(0,s.jsx)("span",{className:"flex items-center gap-x-2 justify-end whitespace-nowrap",children:n})]})]})};return(0,s.jsxs)(l.m_,{"data-sentry-element":"Tooltip","data-sentry-component":"TimestampInfo","data-sentry-source-file":"index.tsx",children:[(0,s.jsx)(l.k$,{asChild:!0,ref:b,className:"text-xs ".concat(n," border-b border-transparent hover:border-dashed hover:border-foreground-light"),"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"index.tsx",children:(0,s.jsx)("span",{children:"local"===o?f({utcTimestamp:t,format:d}):g({utcTimestamp:t,format:d})})}),(0,s.jsxs)(l.ZI,{align:x,side:"right",className:"font-mono p-0 py-1 min-w-80","data-sentry-element":"TooltipContent","data-sentry-source-file":"index.tsx",children:[(0,s.jsx)(j,{label:"UTC",value:m,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(j,{label:v,value:u,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(j,{label:"Relative",value:p,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(j,{label:"Timestamp",value:String(t),"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"})]})]})}},18568:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let s=(0,n(15740).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},26107:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let s=(0,n(15740).A)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},26860:(e,t,n)=>{"use strict";n.d(t,{A:()=>g});var s=n(80263),a=n(10726),r=n(11203),i=n.n(r),l=n(53239),o=n(1848),c=n(59676),d=n(92777),u=n(70800),m=n(51500),p=n(60115);let x=(0,l.createContext)({onChange:e=>{},selected:void 0});var h=n(80903);function f(e){let{children:t,className:n,buttonClassName:r,descriptionText:h,error:f,icon:g,id:y="",name:b="",label:v,labelOptional:j,layout:w,value:N,onChange:S,onFocus:_,onBlur:E,style:R,size:A="medium",defaultValue:k,validation:C,disabled:L,optionsWidth:T}=e,[D,I]=(0,l.useState)(void 0),[z,M]=(0,l.useState)({}),O=(0,u.A)("listbox"),P=(0,l.useRef)(null),{formContextOnChange:H,values:F,errors:B,handleBlur:W,touched:q,fieldLevelValidation:V}=(0,p.x)();F&&!N&&(N=F[y||b],k=F[y||b]),f||(B&&!f&&(f=B[y||b]),f=q&&q[y||b]?f:void 0),(0,l.useEffect)(()=>{void 0!==N&&I(N)},[N]),(0,l.useEffect)(()=>{function e(){var e;document.documentElement.style.setProperty("--width-listbox","".concat(T||(null==(e=P.current)?void 0:e.offsetWidth),"px"))}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,l.useEffect)(()=>{var e;let n=i()(t);function s(e){return n.find(t=>t.props.value===e)}if(N){I(N);let e=s(N);M((null==e?void 0:e.props)?e.props:void 0);return}if(D){let e=s(D);M((null==e?void 0:e.props)?e.props:void 0);return}if(k){I(k);let e=s(D);M((null==e?void 0:e.props)?e.props:void 0);return}M(null==(e=n[0])?void 0:e.props)},[D]);let $=[O.container,O.base,r],U=[O.addOnBefore];return f&&$.push(O.variants.error),f||$.push(O.variants.standard),g&&U.push(O.with_icon),A&&$.push(O.size[A]),L&&$.push(O.disabled),(0,s.jsx)(o.H,{label:v,labelOptional:j,layout:w,id:y,error:f,descriptionText:h,className:n,style:R,size:A,"data-sentry-element":"FormLayout","data-sentry-component":"Listbox","data-sentry-source-file":"Listbox2.tsx",children:(0,s.jsxs)(a.bL,{"data-sentry-element":"unknown","data-sentry-source-file":"Listbox2.tsx",children:[(0,s.jsx)(a.l9,{asChild:!0,disabled:L,"data-sentry-element":"unknown","data-sentry-source-file":"Listbox2.tsx",children:(0,s.jsxs)("button",{"data-size":A,ref:P,className:(0,m.cn)($),onBlur:function(e){W&&W(e),E&&E(e)},onFocus:_,name:b,id:y,children:[(0,s.jsxs)("span",{className:(0,m.cn)(U),children:[g&&(0,s.jsx)(d.A,{size:A,icon:g}),(null==z?void 0:z.addOnBefore)&&(0,s.jsx)(z.addOnBefore,{}),(0,s.jsx)("span",{className:O.label,children:null==z?void 0:z.label})]}),(0,s.jsx)("span",{className:O.chevron_container,children:(0,s.jsx)("svg",{className:O.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-sentry-element":"svg","data-sentry-source-file":"Listbox2.tsx",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd","data-sentry-element":"path","data-sentry-source-file":"Listbox2.tsx"})})}),f&&(0,s.jsx)("div",{className:O.actions_container,children:f&&(0,s.jsx)(c.A,{size:A})})]})}),(0,s.jsx)(a.UC,{sideOffset:6,loop:!0,side:"bottom",align:"center",className:O.options_container,"data-sentry-element":"unknown","data-sentry-source-file":"Listbox2.tsx",children:(0,s.jsx)("div",{children:(0,s.jsx)(x.Provider,{value:{onChange:function(e){S&&S(e),I(e);let t={};t.target={type:"select",name:b,id:y,value:e,checked:void 0},H&&H(t),C&&V(y,C(e))},selected:D},"data-sentry-element":"unknown","data-sentry-source-file":"Listbox2.tsx",children:t})})})]})})}f.Option=function(e){let{id:t,value:n,label:r,disabled:i=!1,children:l,className:o="",addOnBefore:c}=e,d=(0,u.A)("listbox");return(0,s.jsx)(x.Consumer,{"data-sentry-element":"unknown","data-sentry-component":"SelectOption","data-sentry-source-file":"Listbox2.tsx",children:e=>{let{onChange:r,selected:u}=e,p=u===n;return(0,s.jsxs)(a.q7,{className:(0,m.cn)(d.option,p?d.option_active:" ",i?d.option_disabled:" ",o),onSelect:()=>i?{}:r(n),children:[(0,s.jsxs)("div",{className:d.option_inner,children:[c&&c({active:p,selected:u}),(0,s.jsx)("span",{children:"function"==typeof l?l({active:p,selected:u}):l})]}),p?(0,s.jsx)("span",{className:(0,m.cn)(d.option_check,p?d.option_check_active:""),children:(0,s.jsx)(h.A,{className:d.option_check_icon,"aria-hidden":"true"})}):null]},t)}})};let g=f},33647:(e,t,n)=>{"use strict";n.d(t,{j:()=>d});var s=n(56947),a=n(65172),r=n(5483),i=n(63492),l=n(30784),o=n(89811);async function c(e,t,n){let{projectRef:s,connectionString:r,schema:i}=e;if(!s)throw Error("projectRef is required");let l=new Headers(n);r&&l.set("x-connection-encrypted",r);let{data:c,error:d}=await (0,a.Jt)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":r,"x-pg-application-name":o.r},path:{ref:s},query:{included_schemas:i||"",excluded_schemas:""}},headers:l,signal:t});return d&&(0,a.H4)(d),c}let d=function(e){let{projectRef:t,connectionString:n,schema:a}=e,{enabled:o=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=(0,r.KT)(),m=(null==u?void 0:u.status)===i.BU.ACTIVE_HEALTHY;return(0,s.I)(l.S.list(t,a),e=>{let{signal:s}=e;return c({projectRef:t,connectionString:n,schema:a},s)},{enabled:o&&void 0!==t&&m,...d})}},33882:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let s=(0,n(15740).A)("Pointer",[["path",{d:"M22 14a8 8 0 0 1-8 8",key:"56vcr3"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1agjmk"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1",key:"wdbh2u"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10",key:"1ibuk9"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"g6ys72"}]])},35414:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let s=(0,n(15740).A)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]])},35802:(e,t,n)=>{"use strict";n.d(t,{S:()=>a,t:()=>s});let s=(e,t,n,s,a)=>{let r=(null==s?void 0:s.find(s=>{var r,i;return(null==s||null==(r=s.metadata)?void 0:r.name)===e&&(null==s||null==(i=s.metadata)?void 0:i.schema)===a&&(null==s?void 0:s.name)===t&&n.includes(null==s?void 0:s.level)}))||null;return{hasLint:null!==r,count:+!!r,matchingLint:r}},a=(e,t)=>{if(0===t.length)return"";let n=e.columns.map(e=>'"'.concat(e.name,'"')).join(", "),s=t.map(t=>{let n={...t};"idx"in n&&delete n.idx;let s=Object.entries(n).map(t=>{var n;let[s,a]=t,{dataType:r,format:i}=null!=(n=e.columns.find(e=>e.name===s))?n:{};return null===a?"null":"ARRAY"===r?"'".concat(JSON.stringify(a).replace("[","{").replace(/.$/,"}"),"'"):(null==i?void 0:i.includes("json"))?"".concat(JSON.stringify(a).replace(/\\"/g,'"').replace(/'/g,"''").replace('"',"'").replace(/.$/,"'")):"'".concat(a,"'")});return"(".concat(s.join(", "),")")}).join(", ");return'INSERT INTO "'.concat(e.schema,'"."').concat(e.name,'" (').concat(n,") VALUES ").concat(s,";")}},39336:(e,t,n)=>{"use strict";n.d(t,{$:()=>c,I:()=>o});var s=n(56947),a=n(15629),r=n(5013),i=n(92403);let l=e=>{let{id:t}=e;return"\n    ".concat(r.n,"\n\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ").concat(t,"\n    )\n    select pg_temp.pg_get_tabledef (\n      t.schema,\n      t.name,\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n    from table_info t;\n  ").trim()};async function o(e,t){let{projectRef:n,connectionString:s,id:r}=e;if(!r)throw Error("id is required");let i=l({id:r}),{result:o}=await (0,a.E)({projectRef:n,connectionString:s,sql:i,queryKey:["table-definition",r]},t);return o[0].definition.trim()}let c=function(e){let{projectRef:t,connectionString:n,id:a}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)(i.c.tableDefinition(t,a),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n,id:a},s)},{enabled:r&&void 0!==t&&void 0!==a&&!isNaN(a),...l})}},40162:(e,t,n)=>{"use strict";n.d(t,{V:()=>h});var s=n(80263),a=n(90478),r=n(96872),i=n(6772),l=n(34531),o=n(53239),c=n(16838),d=n(80586),u=n(55501),m=n(51500),p=n(40022),x=n(47142);let h=e=>{let{table:t,open:n,onOpenChange:h}=e,{ref:f}=(0,a.g)(),[g,y]=(0,o.useState)("csv"),{data:b}=(0,i.Vh)({projectRef:f}),v=(null!=b?b:[]).find(e=>e.identifier===f),j=(0,l.Av)(v||{db_user:"",db_host:"",db_port:"",db_name:""},["db_host","db_name","db_port","db_user","inserted_at"]),{db_host:w,db_port:N,db_user:S,db_name:_}=j,E=(0,r.H)({connectionInfo:j,metadata:{projectRef:f},poolingInfo:{connectionString:"",db_host:"",db_name:"",db_port:0,db_user:""}}),R="".concat(null==t?void 0:t.name,"_rows"),A="\n".concat(E.direct.psql,' -c "COPY (SELECT * FROM "').concat(null==t?void 0:t.schema,'"."').concat(null==t?void 0:t.name,"\") TO STDOUT WITH CSV HEADER DELIMITER ',';\" > ").concat(R,".csv\n").trim(),k="\npg_dump -h ".concat(w," -p ").concat(N," -d ").concat(_," -U ").concat(S,' --table="').concat(null==t?void 0:t.schema,".").concat(null==t?void 0:t.name,'" --data-only --column-inserts > ').concat(R,".sql\n  ").trim();return(0,s.jsx)(c.lG,{open:n,onOpenChange:h,"data-sentry-element":"Dialog","data-sentry-component":"ExportDialog","data-sentry-source-file":"ExportDialog.tsx",children:(0,s.jsxs)(c.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"ExportDialog.tsx",children:[(0,s.jsx)(c.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"ExportDialog.tsx",children:(0,s.jsx)(c.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"ExportDialog.tsx",children:"Export table data via CLI"})}),(0,s.jsx)(c.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"ExportDialog.tsx"}),(0,s.jsxs)(c.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"ExportDialog.tsx",children:[(0,s.jsxs)("p",{className:"text-sm",children:["We highly recommend using ",(0,s.jsx)("code",{children:"csv"===g?"psql":"pg_dump"})," to export your table data, in particular if your table is relatively large. This can be done via the following command that you can run in your terminal:"]}),(0,s.jsxs)(d.tU,{value:g,onValueChange:y,"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:[(0,s.jsxs)(d.j7,{className:"gap-x-3","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:[(0,s.jsx)(d.Xi,{value:"csv","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:"As CSV"}),(0,s.jsx)(d.Xi,{value:"sql","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:"As SQL"})]}),(0,s.jsx)(d.av,{value:"csv","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:(0,s.jsx)(u.N,{hideLineNumbers:!0,wrapperClassName:(0,m.cn)("[&_pre]:px-4 [&_pre]:py-3"),language:"bash",value:A,className:"[&_code]:text-[12px] [&_code]:text-foreground","data-sentry-element":"CodeBlock","data-sentry-source-file":"ExportDialog.tsx"})}),(0,s.jsx)(d.av,{value:"sql","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:(0,s.jsx)(u.N,{hideLineNumbers:!0,wrapperClassName:(0,m.cn)("[&_pre]:px-4 [&_pre]:py-3"),language:"bash",value:k,className:"[&_code]:text-[12px] [&_code]:text-foreground","data-sentry-element":"CodeBlock","data-sentry-source-file":"ExportDialog.tsx"})})]}),(0,s.jsxs)("p",{className:"text-sm",children:["You will be prompted for your database password, and the output file"," ",(0,s.jsxs)("code",{children:[R,".",g]})," ","will be saved in the current directory that your terminal is in."]}),"sql"===g&&(0,s.jsx)(x.Z,{type:"note",title:"The pg_dump version needs to match your Postgres version",children:(0,s.jsxs)("p",{className:"!leading-normal",children:["If you run into a server version mismatch error, you will need to update"," ",(0,s.jsx)("code",{children:"pg_dump"})," before running the command."]})})]}),(0,s.jsx)(c.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"ExportDialog.tsx",children:(0,s.jsx)(p.$,{type:"default",onClick:()=>h(!1),"data-sentry-element":"Button","data-sentry-source-file":"ExportDialog.tsx",children:"Close"})})]})})}},44326:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var s=n(80263),a=n(53239),r=n(67120),i=n(27642),l=n(40022);let o=e=>{let{visible:t=!1,danger:n=!1,title:o="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:p=()=>{},onSelectConfirm:x=()=>{}}=e;(0,a.useEffect)(()=>{t&&f(!1)},[t]);let[h,f]=(0,a.useState)(!1),g=()=>{f(!0),x()};return(0,s.jsx)(r.A,{header:o,visible:t,title:o,description:c,size:d,hideFooter:!0,onCancel:p,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,s.jsx)(i.A,{initialValues:{},validateOnBlur:!0,onSubmit:()=>g(),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(r.A.Content,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(l.$,{block:!0,htmlType:"button",type:"default",onClick:p,disabled:h,children:"Cancel"}),(0,s.jsx)(l.$,{htmlType:"submit",block:!0,type:n?"danger":"primary",disabled:h,loading:h,children:m&&h?m:u||"Confirm"})]})})})})})}},44665:(e,t,n)=>{"use strict";n.d(t,{A:()=>ep});var s=n(80263),a=n(60045),r=n(3689),i=n(51935),l=n(53239),o=n(90478),c=n(78226),d=n(40162),u=n(91746),m=n(81923),p=n(20313),x=n(88602),h=n(3829),f=n(79015),g=n(85265),y=n(23748),b=n(43089),v=n(75019),j=n(65303),w=n(86505),N=n(56776),S=n(79033),_=n(9681),E=n(40022),R=n(74245),A=n(19428),k=n(4601),C=n(98832),L=n(63603),T=n(95137),D=n.n(T),I=n(54925),z=n(29277),M=n(11192),O=n(29012),P=n(36902),H=n(67201),F=n(17089),B=n(8185),W=n(15601),q=n.n(W),V=n(77191),$=n.n(V),U=n(73969),G=n(49427),Q=n(76129),J=n(35802),K=n(92171),Y=n(39336),X=n(99127),Z=n(88338),ee=n(41728),et=n(15713),en=n(34487),es=n(55555),ea=n(51500),er=n(12644),ei=n(78721),el=n(71139),eo=n(52647);let ec=e=>{let{entity:t,isActive:n,tableHasLints:a,viewHasLints:r,materializedViewHasLints:i}=e,l="";switch(t.type){case g.z.TABLE:a&&(l="RLS disabled");break;case g.z.VIEW:r&&(l="Security definer view");break;case g.z.MATERIALIZED_VIEW:i&&(l="Security definer view");break;case g.z.FOREIGN_TABLE:l="RLS is not enforced on foreign tables"}return l?(0,s.jsxs)(ei.m_,{disableHoverableContent:!0,children:[(0,s.jsx)(ei.k$,{className:"min-w-4",children:(0,s.jsx)(B.A,{size:14,strokeWidth:2,className:(0,ea.cn)("min-w-4",n?"text-warning-600":"text-warning-500")})}),(0,s.jsx)(ei.ZI,{side:"bottom",children:(0,s.jsx)("span",{children:l})})]}):null},ed=e=>{let{id:t,projectRef:n,item:a,isLocked:r,isActive:i,onExportCLI:l}=e,{project:c}=(0,C.Om)(),d=(0,S.ap)(),{selectedSchema:u}=(0,w.k)(),m=(0,es.lW)(a.type,{id:a.id}),p=(0,es.zv)(),x=p.previewTabId===m,h=Object.values(p.tabsMap).some(e=>{var t;return(null==(t=e.metadata)?void 0:t.tableId)===a.id}),f=Number(t)===a.id,y=f&&!r,{data:v=[]}=(0,X.b)({projectRef:null==c?void 0:c.ref}),j=(0,J.t)(a.name,"rls_disabled_in_public",["ERROR"],v,u).hasLint,N=(0,J.t)(a.name,"security_definer_view",["ERROR","WARN"],v,u).hasLint,_=(0,J.t)(a.name,"materialized_view_in_api",["ERROR","WARN"],v,u).hasLint,E=async()=>{if(o.pe&&!(null==c?void 0:c.connectionString))return console.error("Connection string is required");let e=U.oR.loading("Exporting ".concat(a.name," as CSV..."));try{let t=await (0,b.Ap)({id:a.id,projectRef:n,connectionString:null==c?void 0:c.connectionString});if((0,ee.KO)(t)&&t.live_rows_estimate>G.Jv)return U.oR.error((0,s.jsx)("div",{className:"text-foreground prose text-sm",children:G.RH}),{id:e});let r=t&&(0,Q.rH)(t);if(!r)return U.oR.error("Failed to export table: ".concat(a.name),{id:e});let i=(await (0,et.HQ)({projectRef:n,connectionString:null==c?void 0:c.connectionString,table:r})).map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));if(i.length>0){let e=$().unparse(i,{columns:r.columns.map(e=>e.name)}),t=new Blob([e],{type:"text/csv;charset=utf-8;"});D()(t,"".concat(a.name,"_rows.csv"))}U.oR.success("Successfully exported ".concat(a.name," as CSV"),{id:e})}catch(t){U.oR.error("Failed to export table: ".concat(t.message),{id:e})}},R=async()=>{if(o.pe&&!(null==c?void 0:c.connectionString))return console.error("Connection string is required");let e=U.oR.loading("Exporting ".concat(a.name," as SQL..."));try{let t=await (0,b.Ap)({id:a.id,projectRef:n,connectionString:null==c?void 0:c.connectionString});if((0,ee.KO)(t)&&t.live_rows_estimate>G.Jv)return U.oR.error((0,s.jsx)("div",{className:"text-foreground prose text-sm",children:G.RH}),{id:e});let r=t&&(0,Q.rH)(t);if(!r)return U.oR.error("Failed to export table: ".concat(a.name),{id:e});let i=(await (0,et.HQ)({projectRef:n,connectionString:null==c?void 0:c.connectionString,table:r})).map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));if(i.length>0){let e=(0,J.S)(r,i),t=new Blob([e],{type:"text/sql;charset=utf-8;"});D()(t,"".concat(a.name,"_rows.sql"))}U.oR.success("Successfully exported ".concat(a.name," as SQL"),{id:e})}catch(t){U.oR.error("Failed to export table: ".concat(t.message),{id:e})}};return(0,s.jsx)(Z.tv,{title:a.name,id:String(a.id),href:"/project/".concat(n,"/editor/").concat(a.id,"?schema=").concat(a.schema),role:"button","aria-label":"View ".concat(a.name),className:(0,ea.cn)((0,er.u2)({isSelected:f&&!x,isOpened:h&&!x,isPreview:x}),"px-4"),onDoubleClick:e=>{e.preventDefault();let t=(0,es.lW)(a.type,{id:a.id});p.makeTabPermanent(t)},"data-sentry-element":"EditorTablePageLink","data-sentry-component":"EntityListItem","data-sentry-source-file":"EntityListItem.tsx",children:(0,s.jsxs)(s.Fragment,{children:[f&&(0,s.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),(0,s.jsxs)(ei.m_,{disableHoverableContent:!0,"data-sentry-element":"Tooltip","data-sentry-source-file":"EntityListItem.tsx",children:[(0,s.jsx)(ei.k$,{className:"min-w-4","data-sentry-element":"TooltipTrigger","data-sentry-source-file":"EntityListItem.tsx",children:(0,s.jsx)(K.L,{type:a.type,isActive:f,"data-sentry-element":"EntityTypeIcon","data-sentry-source-file":"EntityListItem.tsx"})}),(0,s.jsx)(ei.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"EntityListItem.tsx",children:(e=>{var t,n,s,a;return null==(a=Object.entries(g.z).find(t=>{let[,n]=t;return n===e}))||null==(s=a[0])||null==(n=s.toLowerCase())||null==(t=n.split("_"))?void 0:t.join(" ")})(a.type)})]}),(0,s.jsxs)("div",{className:(0,ea.cn)("truncate","overflow-hidden text-ellipsis whitespace-nowrap flex items-center gap-2 relative w-full",f&&"text-foreground"),children:[(0,s.jsx)("span",{className:(0,ea.cn)(f?"text-foreground":"text-foreground-light group-hover:text-foreground","text-sm","transition","truncate"),children:a.name}),(0,s.jsx)(ec,{entity:a,isActive:f,tableHasLints:j,viewHasLints:N,materializedViewHasLints:_,"data-sentry-element":"EntityTooltipTrigger","data-sentry-source-file":"EntityListItem.tsx"})]}),y&&(0,s.jsxs)(el.rI,{children:[(0,s.jsx)(el.ty,{className:"text-foreground-lighter transition-all text-transparent group-hover:text-foreground data-[state=open]:text-foreground",children:(0,s.jsx)(I.A,{size:14,strokeWidth:2})}),(0,s.jsxs)(el.SQ,{side:"bottom",align:"start",className:"w-44",children:[(0,s.jsxs)(el._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),(0,eo.l)(a.name)},children:[(0,s.jsx)(z.A,{size:12}),(0,s.jsx)("span",{children:"Copy name"})]},"copy-name"),function(e){return(null==e?void 0:e.type)===g.z.TABLE||(null==e?void 0:e.type)===g.z.PARTITIONED_TABLE}(a)&&(0,s.jsxs)(el._2,{className:"space-x-2",onClick:async e=>{e.stopPropagation();let t=U.oR.loading("Getting table schema..."),n=await (0,Y.I)({id:a.id,projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString});if(!n)return U.oR.error("Failed to get table schema",{id:t});try{let e=(0,en.A)(n);await (0,eo.l)(e),U.oR.success("Table schema copied to clipboard",{id:t})}catch(e){U.oR.error("Failed to copy schema: "+(e.message||e),{id:t})}},children:[(0,s.jsx)(z.A,{size:12}),(0,s.jsx)("span",{children:"Copy table schema"})]},"copy-schema"),a.type===g.z.TABLE&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(el.mB,{}),(0,s.jsxs)(el._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),d.onEditTable()},children:[(0,s.jsx)(M.A,{size:12}),(0,s.jsx)("span",{children:"Edit table"})]},"edit-table"),(0,s.jsxs)(el._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),d.onDuplicateTable()},children:[(0,s.jsx)(O.A,{size:12}),(0,s.jsx)("span",{children:"Duplicate table"})]},"duplicate-table"),(0,s.jsx)(el._2,{className:"space-x-2",asChild:!0,children:(0,s.jsxs)(q(),{href:"/project/".concat(n,"/auth/policies?schema=").concat(u,"&search=").concat(a.id),children:[(0,s.jsx)(P.A,{size:12}),(0,s.jsx)("span",{children:"View policies"})]},"view-policies")},"view-policies"),(0,s.jsxs)(el.lv,{children:[(0,s.jsxs)(el.nV,{className:"gap-x-2",children:[(0,s.jsx)(H.A,{size:12}),"Export data"]}),(0,s.jsxs)(el.M5,{children:[(0,s.jsx)(el._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),E()},children:(0,s.jsx)("span",{children:"Export table as CSV"})},"download-table-csv"),(0,s.jsx)(el._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),R()},children:(0,s.jsx)("span",{children:"Export table as SQL"})},"download-table-sql"),(0,s.jsx)(el._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),l()},children:(0,s.jsx)("span",{children:"Export table via CLI"})},"download-table-cli")]})]}),(0,s.jsx)(el.mB,{}),(0,s.jsxs)(el._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),d.onDeleteTable()},children:[(0,s.jsx)(F.A,{size:12}),(0,s.jsx)("span",{children:"Delete table"})]},"delete-table")]})]})]})]})})};var eu=n(33882);let em=()=>(0,s.jsx)(k.Q5,{title:"No tables or views",description:"Any tables or views you create will be listed here.",className:"mx-4","data-sentry-element":"InnerSideBarEmptyPanel","data-sentry-component":"TableMenuEmptyState","data-sentry-source-file":"TableMenuEmptyState.tsx",children:(0,s.jsx)("div",{className:"top-0 left-6 flex flex-col opacity-50 cursor-not-allowed bg-dash-sidebar h-content -mb-7 pointer-events-none scale-75",children:(0,s.jsxs)("div",{className:"relative h-content",children:[(0,s.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent from-80% to-100% to-background-surface-100 dark:to-background-surface-75"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent from-50% to-100% to-background-surface-100 dark:to-background-surface-75"})]}),(0,s.jsx)("div",{className:"absolute left-[150px] bottom-[21px] text-foreground-muted z-10 pointer-events-none",children:(0,s.jsx)(eu.A,{size:16,className:"text-foreground-light",strokeWidth:1.5,"data-sentry-element":"Pointer","data-sentry-source-file":"TableMenuEmptyState.tsx"})}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)("div",{className:"border-l pointer-events-none",children:(0,s.jsxs)("div",{className:(0,ea.cn)("group",(0,er.u2)({isSelected:2===t,isOpened:2===t,isPreview:!1}),"px-4 min-w-40"),"aria-selected":2===t,children:[2===t&&(0,s.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),(0,s.jsx)(K.L,{type:"r"}),"postgres_table_".concat(t)]})},"some-".concat(t)))]})})}),ep=()=>{var e,t,n;let{id:T}=(0,o.g)(),D=T?Number(T):void 0,I=(0,S.ap)(),{selectedSchema:z,setSelectedSchema:M}=(0,w.k)(),O=(0,c.d)(),[P,H]=(0,l.useState)(""),[F,B]=(0,l.useState)(),[W,q]=(0,l.useState)(Object.values(g.z)),[V,$]=(0,j.M)("table-editor-sort","alphabetical"),{project:U}=(0,C.Om)(),{data:G,isLoading:Q,isSuccess:J,isError:K,error:Y,hasNextPage:X,isFetchingNextPage:Z,fetchNextPage:ee}=(0,y.kD)({projectRef:null==U?void 0:U.ref,connectionString:null==U?void 0:U.connectionString,schemas:[z],search:P.trim()||void 0,sort:V,filterTypes:W},{keepPreviousData:!!P}),et=(0,l.useMemo)(()=>null==G?void 0:G.pages.flatMap(e=>e.data.entities),[null==G?void 0:G.pages]),en=(0,v.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"tables"),{isSchemaLocked:es,reason:ea}=(0,N.BQ)({schema:z}),{data:er}=(0,b.Pk)({projectRef:null==U?void 0:U.ref,connectionString:null==U?void 0:U.connectionString,id:D});(0,l.useEffect)(()=>{(null==er?void 0:er.schema)&&M(er.schema)},[null==er?void 0:er.schema]);let ei=(0,L.B)();return(0,l.useEffect)(()=>{et&&!P&&ei({schemas:[z],entities:et})},[et,P,z,ei]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col flex-grow gap-5 pt-5 h-full",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1.5",children:[(0,s.jsx)(f.A,{className:"mx-4",selectedSchemaName:z,onSelectSchema:e=>{H(""),M(e)},onSelectCreateSchema:()=>I.onAddSchema(),"data-sentry-element":"SchemaSelector","data-sentry-source-file":"TableEditorMenu.tsx"}),(0,s.jsx)("div",{className:"grid gap-3 mx-4",children:es?(0,s.jsx)(u.i,{size:"sm",schema:z,entity:"table"}):(0,s.jsx)(x.G,{block:!0,title:"Create a new table",name:"New table",disabled:!en,size:"tiny",icon:(0,s.jsx)(r.A,{size:14,strokeWidth:1.5,className:"text-foreground-muted"}),type:"default",className:"justify-start",onClick:I.onAddTable,tooltip:{content:{side:"bottom",text:en?void 0:"You need additional permissions to create tables"}},children:"New table"})})]}),(0,s.jsxs)("div",{className:"flex flex-auto flex-col gap-2 pb-4",children:[(0,s.jsxs)(k.a0,{className:"mx-2","data-sentry-element":"InnerSideBarFilters","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,s.jsx)(k.RK,{autoFocus:!O,name:"search-tables",value:P,placeholder:"Search tables...","aria-labelledby":"Search tables",onChange:e=>H(e.target.value),"data-sentry-element":"InnerSideBarFilterSearchInput","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,s.jsxs)(k.i9,{value:V,onValueChange:e=>$(e),"data-sentry-element":"InnerSideBarFilterSortDropdown","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,s.jsx)(k.Pl,{value:"alphabetical",className:"flex gap-2","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"TableEditorMenu.tsx",children:"Alphabetical"},"alphabetical"),(0,s.jsx)(k.Pl,{value:"grouped-alphabetical","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"TableEditorMenu.tsx",children:"Entity Type"},"grouped-alphabetical")]})}),(0,s.jsxs)(_.AM,{"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,s.jsx)(_.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,s.jsx)(E.$,{type:5!==W.length?"default":"dashed",className:"h-[32px] md:h-[28px] px-1.5",icon:(0,s.jsx)(i.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"TableEditorMenu.tsx"})}),(0,s.jsx)(_.hl,{className:"p-0 w-56",side:"bottom",align:"center","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,s.jsxs)("div",{className:"px-3 pt-3 pb-2 flex flex-col gap-y-2",children:[(0,s.jsx)("p",{className:"text-xs",children:"Show entity types"}),(0,s.jsx)("div",{className:"flex flex-col",children:Object.entries(g.z).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{className:"group flex items-center justify-between py-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(R.S,{id:t,name:t,checked:W.includes(n),onCheckedChange:()=>{W.includes(n)?q(W.filter(e=>e!==n)):q(W.concat([n]))}}),(0,s.jsx)(A.J,{htmlFor:t,className:"capitalize text-xs",children:t.toLowerCase().replace("_"," ")})]}),(0,s.jsx)(E.$,{size:"tiny",type:"default",onClick:()=>q([n]),className:"transition opacity-0 group-hover:opacity-100 h-auto px-1 py-0.5",children:"Select only"})]},t)})})]})})]})]}),Q&&(0,s.jsx)(m.A,{}),K&&(0,s.jsx)("div",{className:"mx-4",children:(0,s.jsx)(p.A,{error:null!=Y?Y:null,subject:"Failed to retrieve tables"})}),J&&(0,s.jsxs)(s.Fragment,{children:[0===P.length&&(null!=(e=null==et?void 0:et.length)?e:0)<=0&&(0,s.jsx)(em,{}),P.length>0&&(null!=(t=null==et?void 0:et.length)?t:0)<=0&&(0,s.jsx)(k.Q5,{className:"mx-2",title:"No results found",description:'Your search for "'.concat(P,'" did not return any results')}),(null!=(n=null==et?void 0:et.length)?n:0)>0&&(0,s.jsx)("div",{className:"flex flex-1 flex-grow","data-testid":"tables-list",children:(0,s.jsx)(h.A,{items:et,ItemComponent:ed,itemProps:{projectRef:null==U?void 0:U.ref,id:Number(D),isSchemaLocked:es,onExportCLI:()=>{let e=null==et?void 0:et.find(e=>e.id===D);e&&B({name:e.name,schema:e.schema})}},getItemSize:()=>28,hasNextPage:X,isLoadingNextPage:Z,onLoadNextPage:()=>ee()})})]})]})]}),(0,s.jsx)(d.V,{table:F,open:!!F,onOpenChange:e=>{e||B(void 0)},"data-sentry-element":"ExportDialog","data-sentry-source-file":"TableEditorMenu.tsx"})]})}},48114:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var s=n(80263),a=n(72852),r=n(37411),i=n(40022);let l=e=>{let{section:t}=e,n=(0,r.qM)();return(0,s.jsx)(i.$,{size:"tiny",type:"default",onClick:()=>{t&&n.setActiveDocsSection(t),n.setShowProjectApiDocs(!0)},icon:(0,s.jsx)(a.A,{strokeWidth:1.5,className:"text-foreground-muted"}),"data-sentry-element":"Button","data-sentry-component":"APIDocsButton","data-sentry-source-file":"APIDocsButton.tsx",children:"API Docs"})}},48649:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let s=(0,n(15740).A)("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]])},49427:(e,t,n)=>{"use strict";n.d(t,{Jv:()=>eh,RH:()=>ef,Ay:()=>eg});var s=n(80263),a=n(60045),r=n(95137),i=n.n(r),l=n(72259),o=n(32137),c=n(84716),d=n(17089),u=n(15601),m=n.n(u),p=n(77191),x=n.n(p),h=n(53239),f=n(73969),g=n(90478),y=n(15998),b=n(25228),v=n(18568),j=n(36902),w=n(8185);let N=(0,n(15740).A)("MousePointer2",[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]]);var S=n(35802),_=n(98832),E=n(48114),R=n(88602),A=n(33647),k=n(91063),C=n(2316),L=n(99127),T=n(41728),D=n(33983),I=n(57132),z=n(75019),M=n(97600),O=n(23385),P=n(56776),H=n(67920),F=n(78721),B=n(40022),W=n(51500),q=n(9681),V=n(44326),$=n(50204),U=n(45957),G=n(32144),Q=n(63413),J=n(56131),K=n(78720),Y=n(80016),X=n(31492),Z=n(27799);function ee(e){let{table:t,isAutofixViewSecurityModalOpen:n,setIsAutofixViewSecurityModalOpen:a}=e,{project:r}=(0,_.Om)(),i=(0,G.jE)(),{isSuccess:l,isLoading:o,data:c}=(0,Q.G_)({id:null==t?void 0:t.id,projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{enabled:n&&(0,T.b4)(t)}),{mutate:d}=(0,K.Y)({onSuccess:async()=>{f.oR.success("View security changed successfully"),a(!1),await i.invalidateQueries(J.O.lint(null==r?void 0:r.ref))},onError:e=>{f.oR.error("Failed to autofix view security: ".concat(e.message))}});return(0,T.b4)(t)?(0,s.jsxs)($.A,{visible:n,size:"xlarge",title:"Confirm autofixing view security",confirmLabel:"Confirm",onCancel:()=>a(!1),onConfirm:()=>(function(){let e='\n	ALTER VIEW "'.concat(t.schema,'"."').concat(t.name,'" SET (security_invoker = on);\n	');d({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,sql:e})})(),"data-sentry-element":"ConfirmationModal","data-sentry-component":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Setting ",(0,s.jsx)("code",{children:"security_invoker=on"})," ensures the View runs with the permissions of the querying user, reducing the risk of unintended data exposure."]}),(0,s.jsxs)("div",{className:"flex items-center gap-8 mt-8",children:[(0,s.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,s.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Existing query"}),(0,s.jsxs)(Y.FK,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[o&&(0,s.jsx)(Z.y,{}),l&&(0,s.jsx)(X.X,{children:"create view ".concat(t.schema,".").concat(t.name," as\n ").concat(c)})]})]}),(0,s.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,s.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Updated query"}),(0,s.jsxs)(Y.FK,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[o&&(0,s.jsx)(Z.y,{}),l&&(0,s.jsx)(X.X,{children:"create view ".concat(t.schema,".").concat(t.name," with (security_invoker = on) as\n ").concat(c)})]})]})]})]}):null}let et=e=>{var t;let{table:n}=e,{ref:r}=(0,g.g)(),{project:i}=(0,_.Om)(),l=(0,O.a)(),{data:o=[]}=(0,L.b)({projectRef:null==i?void 0:i.ref}),c=(0,T.KO)(n),d=(0,T.bL)(n),u=(0,T.eg)(n),p=(0,T.rW)(n),x=(0,M.x)("realtime:all"),{isSchemaLocked:y}=(0,P.BQ)({schema:n.schema}),{mutate:b}=(0,D.e)({onError:e=>{f.oR.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{eb()}}),[G,Q]=(0,h.useState)(!1),[J,K]=(0,h.useState)(!1),[Y,X]=(0,h.useState)(!1),Z=0===(0,H.Ir)().selectedRows.size,et=null==i?void 0:i.ref,{data:en}=(0,A.j)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString}),es=(null!=en?en:[]).filter(e=>e.schema===n.schema&&e.table===n.name),{data:ea}=(0,k._)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString}),er=(null!=ea?ea:[]).find(e=>"supabase_realtime"===e.name),ei=null!=(t=null==er?void 0:er.tables)?t:[],el=ei.some(e=>e.id===(null==n?void 0:n.id)),{mutate:eo,isLoading:ec}=(0,C.H)({onSuccess:()=>{Q(!1)},onError:e=>{f.oR.error("Failed to toggle realtime for ".concat(n.name,": ").concat(e.message))}}),ed=(0,z.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"tables"),eu=(0,z.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"columns"),em="public"===n.schema,{hasLint:ep,matchingLint:ex}=(0,S.t)(n.name,"security_definer_view",["ERROR","WARN"],o,n.schema),{hasLint:eh,matchingLint:ef}=(0,S.t)(n.name,"materialized_view_in_api",["ERROR","WARN"],o,n.schema),{mutate:eg}=(0,I.h)(),ey=async()=>{var e,t;if(!i)return console.error("Project is required");if(!er)return console.error("Unable to find realtime publication");let s=ei.some(e=>e.id==n.id),a=s?ei.filter(e=>e.id!=n.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(n.schema,".").concat(n.name)].concat(ei.map(e=>"".concat(e.schema,".").concat(e.name)));eg({action:"realtime_toggle_table_clicked",properties:{newState:s?"disabled":"enabled",origin:"tableGridHeader"},groups:{project:null!=(e=null==i?void 0:i.ref)?e:"Unknown",organization:null!=(t=null==l?void 0:l.slug)?t:"Unknown"}}),eo({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:er.id,tables:a})},eb=()=>{K(!1)},ev=async()=>{let e={id:n.id,rls_enabled:!(c&&n.rls_enabled)};b({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:n.id,name:n.name,schema:n.schema,payload:e})};return(0,s.jsxs)("div",{className:"sb-grid-header__inner","data-sentry-component":"GridHeaderActions","data-sentry-source-file":"GridHeaderActions.tsx",children:[Z&&(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[!ed&&!eu&&(0,s.jsxs)(F.m_,{children:[(0,s.jsx)(F.k$,{asChild:!0,children:(0,s.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,s.jsx)(F.ZI,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),c&&!y?n.rls_enabled?(0,s.jsx)(s.Fragment,{children:es.length<1&&!y?(0,s.jsx)(R.G,{asChild:!0,type:"default",className:"group",icon:(0,s.jsx)(v.A,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,s.jsx)(m(),{passHref:!0,href:"/project/".concat(et,"/auth/policies?search=").concat(n.id,"&schema=").concat(n.schema),children:"Add RLS policy"})}):(0,s.jsx)(B.$,{asChild:!0,type:es.length<1&&!y?"warning":"default",className:"group",icon:y||es.length>0?(0,s.jsx)("div",{className:(0,W.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",es.length>9?" px-1":"w-[16px]",""),children:(0,s.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:es.length})}):(0,s.jsx)(v.A,{strokeWidth:1.5}),children:(0,s.jsxs)(m(),{passHref:!0,href:"/project/".concat(et,"/auth/policies?search=").concat(n.id,"&schema=").concat(n.schema),children:["Auth ",es.length>1?"policies":"policy"]})})}):(0,s.jsxs)(q.AM,{modal:!1,children:[(0,s.jsx)(q.Wv,{asChild:!0,children:(0,s.jsx)(B.$,{type:"warning",icon:(0,s.jsx)(j.A,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,s.jsxs)(q.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,s.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,s.jsx)(j.A,{size:16})," Row Level Security (RLS)"]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,s.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,s.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!y&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(B.$,{type:"default",onClick:()=>K(!J),children:"Enable RLS for this table"})})]})]})]}):null,u&&ep&&(0,s.jsxs)(q.AM,{modal:!1,children:[(0,s.jsx)(q.Wv,{asChild:!0,children:(0,s.jsx)(B.$,{type:"warning",icon:(0,s.jsx)(w.A,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,s.jsxs)(q.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,s.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,s.jsx)(w.A,{size:16})," Secure your View"]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,s.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,s.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,s.jsx)(B.$,{type:"secondary",onClick:()=>{X(!0)},children:"Autofix"}),(0,s.jsx)(B.$,{type:"default",asChild:!0,children:(0,s.jsx)(m(),{target:"_blank",href:"/project/".concat(r,"/advisors/security?preset=").concat(null==ex?void 0:ex.level,"&id=").concat(null==ex?void 0:ex.cache_key),children:"Learn more"})})]})]})]})]}),p&&eh&&(0,s.jsxs)(q.AM,{modal:!1,children:[(0,s.jsx)(q.Wv,{asChild:!0,children:(0,s.jsx)(B.$,{type:"warning",icon:(0,s.jsx)(w.A,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,s.jsxs)(q.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,s.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,s.jsx)(w.A,{size:16})," Secure your View"]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,s.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,s.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(B.$,{type:"default",asChild:!0,children:(0,s.jsx)(m(),{target:"_blank",href:"/project/".concat(r,"/advisors/security?preset=").concat(null==ef?void 0:ef.level,"&id=").concat(null==ef?void 0:ef.cache_key),children:"Learn more"})})})]})]})]}),d&&"public"===n.schema&&(0,s.jsxs)(q.AM,{modal:!1,children:[(0,s.jsx)(q.Wv,{asChild:!0,children:(0,s.jsx)(B.$,{type:"warning",icon:(0,s.jsx)(w.A,{strokeWidth:1.5}),children:"Unprotected Data API access"})}),(0,s.jsxs)(q.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,s.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,s.jsx)(w.A,{size:16})," Secure Foreign table"]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,s.jsxs)("p",{children:["Foreign tables do not enforce RLS, which may allow unrestricted access. To secure them, either move foreign tables to a private schema not exposed by PostgREST, or ",(0,s.jsx)("a",{href:"",children:"disable PostgREST access"})," entirely."]}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(B.$,{type:"default",asChild:!0,children:(0,s.jsx)(m(),{target:"_blank",href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview#security",children:"Learn more"})})})]})]})]}),(0,s.jsx)(U.g,{serviceRoleLabel:"postgres"}),c&&x&&(0,s.jsxs)(B.$,{type:"default",icon:(0,s.jsx)(N,{strokeWidth:1.5,className:el?"text-brand":"text-foreground-muted"}),onClick:()=>Q(!0),children:["Realtime ",el?"on":"off"]}),em&&(0,s.jsx)(E.A,{section:["entities",n.name]})]}),(0,s.jsx)($.A,{visible:G,loading:ec,title:"".concat(el?"Disable":"Enable"," realtime for ").concat(n.name),confirmLabel:"".concat(el?"Disable":"Enable"," realtime"),confirmLabelLoading:"".concat(el?"Disabling":"Enabling"," realtime"),onCancel:()=>Q(!1),onConfirm:()=>ey(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"GridHeaderActions.tsx",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",el?"disabled":"enabled",", the table will"," ",el?"no longer ":"","broadcast any changes to authorized subscribers."]}),!el&&(0,s.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,s.jsx)(m(),{href:"/project/".concat(r,"/database/publications"),className:"text-brand",children:"database publications"})," ","settings."]})]})}),(0,s.jsx)(ee,{table:n,isAutofixViewSecurityModalOpen:Y,setIsAutofixViewSecurityModalOpen:X,"data-sentry-element":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"GridHeaderActions.tsx"}),c&&(0,s.jsx)(V.A,{danger:n.rls_enabled,visible:J,title:"Confirm to enable Row Level Security",description:"Are you sure you want to enable Row Level Security for this table?",buttonLabel:"Enable RLS",buttonLoadingLabel:"Updating",onSelectCancel:eb,onSelectConfirm:ev})]})};var en=n(23183),es=n(15713),ea=n(66628),er=n(79033),ei=n(71139),el=n(97956),eo=n(77635),ec=n(40162),ed=n(76129),eu=n(37371);let em=e=>{let{portal:t=!0}=e,{urlFilters:n,onApplyFilters:a}=(0,y.M)(),r=(0,h.useMemo)(()=>(0,ed.hl)(null!=n?n:[]),[n]);return(0,s.jsx)(eu.b,{portal:t,filters:r,onApplyFilters:a,"data-sentry-element":"FilterPopoverPrimitive","data-sentry-component":"FilterPopover","data-sentry-source-file":"FilterPopover.tsx"})};var ep=n(32875);let ex=e=>{var t;let{portal:n=!0}=e,{urlSorts:a,onApplySorts:r}=(0,b.G)(),i=(0,H.Ir)(),l=(null==i||null==(t=i.table)?void 0:t.name)||"",o=(0,h.useMemo)(()=>l&&a?(0,ed.FU)(l,a):[],[l,a]);return(0,s.jsx)(ep.l,{portal:n,sorts:o,onApplySorts:r,"data-sentry-element":"SortPopoverPrimitive","data-sentry-component":"SortPopover","data-sentry-source-file":"SortPopover.tsx"})},eh=5e5,ef=(0,s.jsxs)(s.Fragment,{children:["Sorry! We're unable to support exporting row counts larger than $",eh.toLocaleString()," at the moment. Alternatively, you may consider using",(0,s.jsx)(m(),{href:"https://supabase.com/docs/reference/cli/supabase-db-dump",target:"_blank",children:"pg_dump"})," ","via our CLI instead."]}),eg=e=>{let{customHeader:t}=e,n=(0,H.Ir)();return(0,s.jsx)("div",{"data-sentry-component":"Header","data-sentry-source-file":"Header.tsx",children:(0,s.jsxs)("div",{className:"flex h-10 items-center justify-between bg-dash-sidebar dark:bg-surface-100 px-1.5 py-1.5 gap-2 overflow-x-auto ",children:[t||(n.selectedRows.size>0?(0,s.jsx)(eb,{}):(0,s.jsx)(ey,{})),(0,s.jsx)(et,{table:n.originalTable,"data-sentry-element":"GridHeaderActions","data-sentry-source-file":"Header.tsx"})]})})},ey=()=>{var e;let{ref:t}=(0,g.g)(),{data:n}=(0,O.s)(),r=(0,H.Ir)(),i=(0,er.ap)(),d=(0,z.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"columns"),{mutate:u}=(0,I.h)(),m=r.editable&&(null!=(e=r.table.columns)?e:[]).length>0?i.onAddRow:void 0,p=r.editable?i.onAddColumn:void 0,x=r.editable?i.onImportData:void 0;return(0,s.jsxs)("div",{className:"flex items-center gap-4","data-sentry-component":"DefaultHeader","data-sentry-source-file":"Header.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(em,{"data-sentry-element":"FilterPopover","data-sentry-source-file":"Header.tsx"}),(0,s.jsx)(ex,{"data-sentry-element":"SortPopover","data-sentry-source-file":"Header.tsx"})]}),(void 0!==m||void 0!==p)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:d&&(0,s.jsxs)(ei.rI,{children:[(0,s.jsx)(ei.ty,{asChild:!0,children:(0,s.jsx)(B.$,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,s.jsx)(l.A,{strokeWidth:1.5}),children:"Insert"})}),(0,s.jsx)(ei.SQ,{side:"bottom",align:"start",children:[...void 0!==m?[(0,s.jsxs)(ei._2,{className:"group space-x-2",onClick:m,children:[(0,s.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,s.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,s.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,s.jsx)("div",{className:(0,W.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Insert row"}),(0,s.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",r.table.name]})]})]},"add-row")]:[],...void 0!==p?[(0,s.jsxs)(ei._2,{className:"group space-x-2",onClick:p,children:[(0,s.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,s.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,s.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,s.jsx)("div",{className:(0,W.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Insert column"}),(0,s.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",r.table.name]})]})]},"add-column")]:[],...void 0!==x?[(0,s.jsxs)(ei._2,{className:"group space-x-2",onClick:()=>{var e;x(),u({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:null!=t?t:"Unknown",organization:null!=(e=null==n?void 0:n.slug)?e:"Unknown"}})},children:[(0,s.jsxs)("div",{className:"relative -mt-2",children:[(0,s.jsx)(o.A,{size:18,strokeWidth:1.5,className:"-translate-x-[2px]"}),(0,s.jsx)(c.A,{className:(0,W.cn)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:"Import data from CSV"}),(0,s.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]})})]})]})},eb=()=>{var e,t,n;let{project:a}=(0,_.Om)(),r=(0,er.ap)(),o=(0,H.Ir)(),c=(0,ea.RY)(),u=void 0!==c.role,{filters:m}=(0,y.M)(),{sorts:p}=(0,b.G)(),[g,v]=(0,h.useState)(!1),[j,w]=(0,h.useState)(!1),{data:N}=(0,es.vs)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString,tableId:o.table.id,sorts:p,filters:m,page:o.page,limit:r.rowsPerPage,roleImpersonationState:c}),{data:E}=(0,en.gt)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString,tableId:o.table.id,filters:m,enforceExactCount:o.enforceExactCount,roleImpersonationState:c},{keepPreviousData:!0}),A=null!=(e=null==N?void 0:N.rows)?e:[],k=null!=(t=null==E?void 0:E.count)?t:0,C=()=>{o.setSelectedRows(new Set(A.map(e=>e.idx)),!0)},L=async()=>{if(v(!0),o.allRowsSelected&&k>eh)return f.oR.error((0,s.jsx)("div",{className:"prose text-sm text-foreground",children:ef})),v(!1);if(!a)return f.oR.error("Project is required"),v(!1);let e=o.allRowsSelected?(0,f.oR)((0,s.jsx)(el.t,{progress:0,message:"Exporting all rows from ".concat(o.table.name)}),{closeButton:!1,duration:1/0}):f.oR.loading("Exporting ".concat(o.selectedRows.size," row").concat(o.selectedRows.size>1?"s":""," from ").concat(o.table.name)),t=o.allRowsSelected?await (0,es.HQ)({projectRef:a.ref,connectionString:a.connectionString,table:o.table,filters:m,sorts:p,roleImpersonationState:c,progressCallback:t=>{let n=Math.min(t/k*100,100);(0,f.oR)((0,s.jsx)(el.t,{progress:n,message:"Exporting all rows from ".concat(o.table.name)}),{id:e,closeButton:!1,duration:1/0})}}):A.filter(e=>o.selectedRows.has(e.idx));if(0===t.length){f.oR.dismiss(e),f.oR.error("Export failed, please try exporting again"),v(!1);return}let n=t.map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e)),r=new Blob([x().unparse(n,{columns:o.table.columns.map(e=>e.name)})],{type:"text/csv;charset=utf-8;"});f.oR.success("Downloaded ".concat(t.length," rows as CSV"),{id:e,closeButton:!0,duration:4e3}),i()(r,"".concat(o.table.name,"_rows.csv")),v(!1)},T=async()=>{if(v(!0),o.allRowsSelected&&k>eh)return f.oR.error((0,s.jsx)("div",{className:"prose text-sm text-foreground",children:ef})),v(!1);if(!a)return f.oR.error("Project is required"),v(!1);if(o.allRowsSelected&&0===k)return f.oR.error("Export failed, please try exporting again"),v(!1);let e=o.allRowsSelected?(0,f.oR)((0,s.jsx)(el.t,{progress:0,message:"Exporting all rows from ".concat(o.table.name)}),{closeButton:!1,duration:1/0}):f.oR.loading("Exporting ".concat(o.selectedRows.size," row").concat(o.selectedRows.size>1?"s":""," from ").concat(o.table.name)),t=o.allRowsSelected?await (0,es.HQ)({projectRef:a.ref,connectionString:a.connectionString,table:o.table,filters:m,sorts:p,roleImpersonationState:c,progressCallback:t=>{let n=Math.min(t/k*100,100);(0,f.oR)((0,s.jsx)(el.t,{progress:n,message:"Exporting all rows from ".concat(o.table.name)}),{id:e,closeButton:!1,duration:1/0})}}):A.filter(e=>o.selectedRows.has(e.idx));if(0===t.length){f.oR.error("Export failed, please exporting try again"),v(!1);return}let n=new Blob([(0,S.S)(o.table,t)],{type:"text/sql;charset=utf-8;"});f.oR.success("Downloading ".concat(t.length," rows as SQL"),{id:e,closeButton:!0,duration:4e3}),i()(n,"".concat(o.table.name,"_rows.sql")),v(!1)},D=async()=>{if(!a)return f.oR.error("Project is required");v(!0);let e=f.oR.loading("Exporting ".concat(o.selectedRows.size," row").concat(o.selectedRows.size>1?"s":""," from ").concat(o.table.name)),t=A.filter(e=>o.selectedRows.has(e.idx)),n=new Blob([JSON.stringify(t)],{type:"text/sql;charset=utf-8;"});f.oR.success("Downloading ".concat(t.length," rows as JSON"),{id:e,closeButton:!0,duration:4e3}),i()(n,"".concat(o.table.name,"_rows.json")),v(!1)};return(0,ea.sc)(()=>{(o.allRowsSelected||o.selectedRows.size>0)&&o.setSelectedRows(new Set)}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[o.editable&&(0,s.jsx)(R.G,{type:"default",size:"tiny",icon:(0,s.jsx)(d.A,{}),onClick:()=>{let e=o.allRowsSelected?k:o.selectedRows.size,t=Array.from(o.selectedRows),n=A.filter(e=>t.includes(e.idx));r.onDeleteRows(n,{allRowsSelected:o.allRowsSelected,numRows:e,callback:()=>{o.setSelectedRows(new Set)}})},disabled:o.allRowsSelected&&u,tooltip:{content:{side:"bottom",text:o.allRowsSelected&&u?"Table truncation is not supported when impersonating a role":void 0}},children:o.allRowsSelected?"Delete all rows in table":o.selectedRows.size>1?"Delete ".concat(o.selectedRows.size," rows"):"Delete ".concat(o.selectedRows.size," row")}),(0,s.jsxs)(ei.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"Header.tsx",children:[(0,s.jsx)(ei.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"Header.tsx",children:(0,s.jsx)(B.$,{type:"default",size:"tiny",iconRight:(0,s.jsx)(l.A,{}),loading:g,disabled:g,"data-sentry-element":"Button","data-sentry-source-file":"Header.tsx",children:"Export"})}),(0,s.jsxs)(ei.SQ,{className:o.allRowsSelected?"w-52":"w-40","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"Header.tsx",children:[(0,s.jsx)(ei._2,{onClick:L,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"Header.tsx",children:"Export as CSV"}),(0,s.jsx)(ei._2,{onClick:T,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"Header.tsx",children:"Export as SQL"}),o.allRowsSelected?(0,s.jsx)(ei._2,{className:"group",onClick:()=>w(!0),children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"group-hover:text-foreground",children:"Export via CLI"}),(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Recommended for large tables"})]})}):(0,s.jsx)(ei._2,{onClick:D,children:"Export as JSON"})]})]}),!o.allRowsSelected&&k>A.length&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"h-6 ml-0.5",children:(0,s.jsx)(eo.w,{orientation:"vertical"})}),(0,s.jsx)(B.$,{type:"text",onClick:()=>C(),children:"Select all rows in table"})]})]}),(0,s.jsx)(ec.V,{table:{name:o.table.name,schema:null!=(n=o.table.schema)?n:""},open:j,onOpenChange:()=>w(!1),"data-sentry-element":"ExportDialog","data-sentry-source-file":"Header.tsx"})]})}},52634:(e,t,n)=>{"use strict";n.d(t,{AL:()=>c,J5:()=>u,J_:()=>o,N1:()=>l,aw:()=>d,fX:()=>g,mL:()=>m,mN:()=>p,wB:()=>x,wy:()=>f,x0:()=>h});var s=n(86631),a=n.n(s),r=n(14506),i=n.n(r);let l=["int2","int4","int8","float4","float8","numeric","double precision"],o=["json","jsonb"],c=["text","varchar"],d=["timestamp","timestamptz"],u=["date"],m=["time","timetz"],p=a()(d,u,m),x=["uuid","bool","vector","bytea"],h=i()(a()(l,o,c,p,x)),f={varchar:{alternative:"text",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_varchar.28n.29_by_default"},json:{alternative:"jsonb",reference:"https://www.postgresql.org/docs/current/datatype-json.html"},timetz:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timetz"},timestamp:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timestamp_.28without_time_zone.29"}},g=[{name:"int2",description:"Signed two-byte integer",type:"number"},{name:"int4",description:"Signed four-byte integer",type:"number"},{name:"int8",description:"Signed eight-byte integer",type:"number"},{name:"float4",description:"Single precision floating-point number (4 bytes)",type:"number"},{name:"float8",description:"Double precision floating-point number (8 bytes)",type:"number"},{name:"numeric",description:"Exact numeric of selectable precision",type:"number"},{name:"json",description:"Textual JSON data",type:"json"},{name:"jsonb",description:"Binary JSON data, decomposed",type:"json"},{name:"text",description:"Variable-length character string",type:"text"},{name:"varchar",description:"Variable-length character string",type:"text"},{name:"uuid",description:"Universally unique identifier",type:"text"},{name:"date",description:"Calendar date (year, month, day)",type:"time"},{name:"time",description:"Time of day (no time zone)",type:"time"},{name:"timetz",description:"Time of day, including time zone",type:"time"},{name:"timestamp",description:"Date and time (no time zone)",type:"time"},{name:"timestamptz",description:"Date and time, including time zone",type:"time"},{name:"bool",description:"Logical boolean (true/false)",type:"bool"},{name:"bytea",description:"Variable-length binary string",type:"others"}]},54925:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let s=(0,n(15740).A)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},59450:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let s=(0,n(15740).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},60680:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>l});var s=n(80263),a=n(90709);n(53239);var r=n(70800);let i=e=>{let{open:t,children:n,className:r,...i}=e;return(0,s.jsx)(a.bL,{asChild:i.asChild,defaultOpen:i.defaultOpen,open:t,onOpenChange:i.onOpenChange,disabled:i.disabled,className:r,"data-sentry-element":"unknown","data-sentry-component":"Collapsible","data-sentry-source-file":"Collapsible.tsx",children:n})};i.Trigger=function(e){let{children:t,asChild:n}=e;return(0,s.jsx)(a.l9,{asChild:n,"data-sentry-element":"unknown","data-sentry-component":"Trigger","data-sentry-source-file":"Collapsible.tsx",children:t})},i.Content=function(e){let{asChild:t,children:n,className:i}=e,l=(0,r.A)("collapsible");return(0,s.jsx)(a.UC,{asChild:t,className:[l.content,i].join(" "),"data-sentry-element":"unknown","data-sentry-component":"Content","data-sentry-source-file":"Collapsible.tsx",children:n})};let l=i},63413:(e,t,n)=>{"use strict";n.d(t,{G_:()=>o});var s=n(56947),a=n(15629),r=n(92403);let i=e=>{let{id:t}=e;if(!t)throw Error("id is required");return"\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name,\n        to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ".concat(t,"\n    )\n    select pg_get_viewdef(t.regclass, true) as definition\n    from table_info t\n  ").trim()};async function l(e,t){let{projectRef:n,connectionString:s,id:r}=e,l=i({id:r}),{result:o}=await (0,a.E)({projectRef:n,connectionString:s,sql:l,queryKey:["view-definition",r]},t);return o[0].definition.trim()}let o=function(e){let{projectRef:t,connectionString:n,id:a}=e,{enabled:i=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)(r.c.viewDefinition(t,a),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n,id:a},s)},{enabled:i&&void 0!==t&&void 0!==a&&!isNaN(a),...o})}},69036:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});let s=(0,n(15740).A)("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]])},69108:(e,t,n)=>{"use strict";n.d(t,{k:()=>s});let s={list:e=>["projects",e,"views"],listBySchema:(e,t)=>[...s.list(e),t]}},79015:(e,t,n)=>{"use strict";n.d(t,{A:()=>y});var s=n(80263),a=n(60045),r=n(96572),i=n(80903),l=n(3689),o=n(53239),c=n(98832),d=n(63604),u=n(75019),m=n(40022),p=n(53555),x=n(1012),h=n(9681),f=n(61965),g=n(80016);let y=e=>{let{className:t,disabled:n=!1,size:y="tiny",showError:b=!0,selectedSchemaName:v,supportSelectAll:j=!1,excludedSchemas:w=[],onSelectSchema:N,onSelectCreateSchema:S,portal:_=!0}=e,[E,R]=(0,o.useState)(!1),A=(0,u.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"schemas"),{project:k}=(0,c.Om)(),{data:C,isLoading:L,isSuccess:T,isError:D,error:I,refetch:z}=(0,d.w$)({projectRef:null==k?void 0:k.ref,connectionString:null==k?void 0:k.connectionString}),M=(C||[]).filter(e=>!w.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,s.jsxs)("div",{className:t,"data-sentry-component":"SchemaSelector","data-sentry-source-file":"SchemaSelector.tsx",children:[L&&(0,s.jsx)(m.$,{type:"default",className:"w-full [&>span]:w-full",size:y,disabled:!0,children:(0,s.jsx)(p.E,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),b&&D&&(0,s.jsxs)(x.Fc,{variant:"warning",className:"!px-3 !py-3",children:[(0,s.jsx)(x.XL,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,s.jsxs)(x.TN,{className:"text-xs mb-2 break-words",children:["Error: ",null==I?void 0:I.message]}),(0,s.jsx)(m.$,{type:"default",size:"tiny",onClick:()=>z(),children:"Reload schemas"})]}),T&&(0,s.jsxs)(h.AM,{open:E,onOpenChange:R,modal:!1,children:[(0,s.jsx)(h.Wv,{asChild:!0,children:(0,s.jsx)(m.$,{size:y,disabled:n,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,s.jsx)(r.A,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:v?(0,s.jsxs)("div",{className:"w-full flex gap-1",children:[(0,s.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,s.jsx)("p",{className:"text-foreground",children:"*"===v?"All schemas":v})]}):(0,s.jsx)("div",{className:"w-full flex gap-1",children:(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schema…"})})})}),(0,s.jsx)(h.hl,{className:"p-0 min-w-[200px] pointer-events-auto",side:"bottom",align:"start",portal:_,sameWidthAsTrigger:!0,children:(0,s.jsxs)(f.uB,{children:[(0,s.jsx)(f.G7,{placeholder:"Find schema..."}),(0,s.jsxs)(f.oI,{children:[(0,s.jsx)(f.xL,{children:"No schemas found"}),(0,s.jsx)(f.L$,{children:(0,s.jsxs)(g.FK,{className:(M||[]).length>7?"h-[210px]":"",children:[j&&(0,s.jsxs)(f.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{N("*"),R(!1)},onClick:()=>{N("*"),R(!1)},children:[(0,s.jsx)("span",{children:"All schemas"}),"*"===v&&(0,s.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==M?void 0:M.map(e=>(0,s.jsxs)(f.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{N(e.name),R(!1)},onClick:()=>{N(e.name),R(!1)},children:[(0,s.jsx)("span",{children:e.name}),v===e.name&&(0,s.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==S&&A&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.fx,{}),(0,s.jsx)(f.L$,{children:(0,s.jsxs)(f.h_,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{S(),R(!1)},onClick:()=>{S(),R(!1)},children:[(0,s.jsx)(l.A,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},81269:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var s=n(80263),a=n(60045),r=n(98969),i=n(75019),l=n(78098);let o=e=>{let{children:t}=e,n=(0,i.Lh)(),o=(0,i.SE)(a.aG.TENANT_SQL_ADMIN_READ,"tables");return n&&!o?(0,s.jsx)(l.S,{isBlocking:!1,children:(0,s.jsx)(r.A,{isFullPage:!0,resourceText:"view tables from this project"})}):(0,s.jsx)(s.Fragment,{children:t})}},87501:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var s=n(56947),a=n(65172),r=n(63846),i=n(89811);async function l(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:l,error:o}=await (0,a.Jt)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":s,"x-pg-application-name":i.r},path:{ref:n}},headers:Object.fromEntries(r),signal:t});return o&&(0,a.H4)(o),l}let o=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)(r.K.list(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t,...i})}},91063:(e,t,n)=>{"use strict";n.d(t,{_:()=>o});var s=n(56947),a=n(65172),r=n(14155),i=n(89811);async function l(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:l,error:o}=await (0,a.Jt)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":s,"x-pg-application-name":i.r},path:{ref:n}},headers:r,signal:t});return o&&(0,a.H4)(o),l}let o=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)(r.b.list(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t,...i})}},95137:function(e,t,n){var s,a;void 0===(a="function"==typeof(s=function(){"use strict";function t(e,t,n){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="blob",s.onload=function(){l(s.response,t,n)},s.onerror=function(){console.error("could not download file")},s.send()}function s(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,i=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,n,i){var l=r.URL||r.webkitURL,o=document.createElement("a");o.download=n=n||e.name||"download",o.rel="noopener","string"==typeof e?(o.href=e,o.origin===location.origin?a(o):s(o.href)?t(e,n,i):a(o,o.target="_blank")):(o.href=l.createObjectURL(e),setTimeout(function(){l.revokeObjectURL(o.href)},4e4),setTimeout(function(){a(o)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,r){if(n=n||e.name||"download","string"!=typeof e){var i;navigator.msSaveOrOpenBlob((void 0===(i=r)?i={autoBom:!1}:"object"!=typeof i&&(console.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e),n)}else if(s(e))t(e,n,r);else{var l=document.createElement("a");l.href=e,l.target="_blank",setTimeout(function(){a(l)})}}:function(e,n,s,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,s);var l="application/octet-stream"===e.type,o=/constructor/i.test(r.HTMLElement)||r.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||l&&o||i)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},d.readAsDataURL(e)}else{var u=r.URL||r.webkitURL,m=u.createObjectURL(e);a?a.location=m:location.href=m,a=null,setTimeout(function(){u.revokeObjectURL(m)},4e4)}});r.saveAs=l.saveAs=l,e.exports=l})?s.apply(t,[]):s)||(e.exports=a)},95359:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var s=n(80263),a=n(51500);let r=e=>{let{max:t=100,value:n=0,barClass:r="bg-foreground",bgClass:i="",type:l="vertical",borderClass:o="",labelBottom:c="",labelBottomClass:d="tabular-nums",labelTop:u="",labelTopClass:m=""}=e;if("horizontal"===l){let e=Number(n/t*100),l=c||u;return(0,s.jsxs)("div",{className:"flex flex-col w-full",children:[l&&(0,s.jsxs)("div",{className:"flex align-baseline justify-between pb-1 space-x-8",children:[(0,s.jsx)("p",{className:(0,a.cn)("text-foreground text-sm truncate capitalize-sentence",u.length>0&&"max-w-[75%]",d),children:c}),(0,s.jsx)("p",{className:(0,a.cn)("text-foreground-light text-sm",m),children:u})]}),(0,s.jsx)("div",{className:"relative rounded h-1 overflow-hidden w-full border p-0 ".concat(i||"bg-surface-400"," ").concat(o||"border-none"),children:(0,s.jsx)("div",{className:"absolute rounded inset-x-0 bottom-0 h-1 ".concat(r," transition-all"),style:{width:"".concat(e,"%")}})})]})}{let e=Number(n/t*35);return e<2&&(e=2),(0,s.jsx)("div",{className:"relative rounded w-5 overflow-hidden border p-1 ".concat(i||"bg-gray-400"," ").concat(o||"border-none"),style:{height:35},children:(0,s.jsx)("div",{className:"absolute inset-x-0 bottom-0 w-5 ".concat(r),style:{height:e}})})}}},98969:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var s=n(80263),a=n(87610);let r=e=>{let{resourceText:t,isFullPage:n=!1}=e,r=()=>(0,s.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(a.A,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,s.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,s.jsx)("div",{children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return n?(0,s.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,s.jsx)("div",{className:"w-[550px]",children:(0,s.jsx)(r,{})})}):(0,s.jsx)(r,{})}}}]);